{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon icon-->
    <link rel="shortcut icon" type="image/png" href="{% static 'assets/images/logos/favicon.png' %}" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/tabler-icons.min.css">

    <!-- Core Css -->
    <link rel="stylesheet" href="{% static 'css/theme.css' %}" />

    <title>Remote Work Productivity Tracker</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>

<body class="bg-surface">
    <div id="main-wrapper" class="flex h-screen">
		<div class="lg:flex lg:flex-row">
			<aside id="application-sidebar-brand" class="lg:w-64 bg-gray-100 p-4">
				<!-- Start Vertical Layout Sidebar -->
				<div class="p-4">
					<a href="" class="text-nowrap">
						<img src="https://assets.themuse.com/uploaded/companies/12214/small_logo.png?v=5dad600268712acd5fc537403000906a4069baf2e461a0d9e4bde72899c59753" width="100" height="100" />
					</a>
				</div>
				<div class="scroll-sidebar" data-simplebar="">
					<nav class="w-full flex flex-col sidebar-nav px-4 mt-5">
						<ul id="sidebarnav" class="text-gray-600 text-sm">
							<li class="text-xs font-bold pb-[5px]">
								<i class="ti ti-dots nav-small-cap-icon text-lg hidden text-center"></i>
								<span class="text-xs text-gray-400 font-semibold">HOME</span>
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link gap-3 py-2.5 my-1 text-base flex items-center relative rounded-md text-gray-500 w-full" href="./index.html">
									<i class="ti ti-layout-dashboard ps-2 text-2xl"></i>
									<span>Dashboard</span>
								</a>
							</li>
							<li class="sidebar-item">
								<a class="sidebar-link gap-3 py-2.5 my-1 text-base flex items-center relative rounded-md text-gray-500 w-full" href="./components/buttons.html">
									<i class="ti ti-article ps-2 text-2xl"></i>
									<span>Overview</span>
								</a>
							</li>
							<li class="sidebar-item">
								<a class="sidebar-link gap-3 py-2.5 my-1 text-base flex items-center relative rounded-md text-gray-500 w-full" href="./components/alerts.html">
									<i class="ti ti-user ps-2 text-2xl"></i>
									<span>My People</span>
								</a>
							</li>
							<li class="sidebar-item">
								<a class="sidebar-link gap-3 py-2.5 my-1 text-base flex items-center relative rounded-md text-gray-500 w-full" href="./components/cards.html">
									<i class="ti ti-cards ps-2 text-2xl"></i>
									<span>Manage task</span>
								</a>
							</li>
							<li class="sidebar-item">
								<a class="sidebar-link gap-3 py-2.5 my-1 text-base flex items-center relative rounded-md text-gray-500 w-full" href="./components/forms.html">
									<i class="ti ti-file-description ps-2 text-2xl"></i>
									<span>Done</span>
								</a>
							</li>
							<li class="text-xs font-bold mb-4 mt-6">
								<i class="ti ti-dots nav-small-cap-icon text-lg hidden text-center"></i>
								<span class="text-xs text-gray-400 font-semibold">All Priorities</span>
							</li>
							<li class="text-xs font-bold mb-4 mt-6">
								<i class="ti ti-dots nav-small-cap-icon text-lg hidden text-center"></i>
								<span class="text-xs text-gray-400 font-semibold">Low</span>
							</li>
							<li class="text-xs font-bold mb-4 mt-6">
								<i class="ti ti-dots nav-small-cap-icon text-lg hidden text-center"></i>
								<span class="text-xs text-gray-400 font-semibold">Medium</span>
							</li>
							<li class="text-xs font-bold mb-4 mt-6">
								<i class="ti ti-dots nav-small-cap-icon text-lg hidden text-center"></i>
								<span class="text-xs text-gray-400 font-semibold">High</span>
							</li>
						</ul>
					</nav>
					<!-- Bottom Upgrade Option -->
					<div class="m-4 relative grid">
						<a href="{% url 'new_task' %}">
                    	<button class="text-base font-semibold hover:bg-blue-700 btn">Add New Task</button>
                		</a>
            		</div>
        		</div>
    		</aside>
        </div>
        <main class="lg:flex-1">
            <header>
                <!-- Header content here -->
                <nav class="w-full flex items-center justify-between" aria-label="Global">
                    <ul class="icon-nav flex items-center gap-4">
                        <li class="relative xl:hidden">
                            <button class="text-xl  icon-hover cursor-pointer text-heading" id="headerCollapse" data-hs-overlay="#application-sidebar-brand" aria-controls="application-sidebar-brand" aria-label="Toggle navigation">
                                <i class="ti ti-menu-2 relative z-1"></i>
                            </button>
                        </li>
                        <li class="relative">
                            <div class="hs-dropdown relative inline-flex [--placement:bottom-left] sm:[--trigger:hover]">
                                <a class="relative hs-dropdown-toggle inline-flex hover:text-gray-500 text-gray-300" href="#">
                                </a>
                                <div class="card hs-dropdown-menu transition-[opacity,margin] rounded-md duration hs-dropdown-open:opacity-100 opacity-0 mt-2 min-w-max  w-[300px] hidden z-[12]"
                                     aria-labelledby="hs-dropdown-custom-icon-trigger">
                                    <div>
                                        <h3 class="text-gray-500 font-semibold text-base px-6 py-3">Notification</h3>
                                        <ul class="list-none  flex flex-col">
                                            <li>
                                                <a href="#" class="py-3 px-6 block hover:bg-gray-200">
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="py-3 px-6 block hover:bg-gray-200">
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="py-3 px-6 block hover:bg-gray-200">
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="py-3 px-6 block hover:bg-gray-200">
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="py-3 px-6 block hover:bg-gray-200">
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div class="flex items-center gap-4">
                        <div class="hs-dropdown relative inline-flex [--placement:bottom-right] sm:[--trigger:hover]">
                            <a class="relative hs-dropdown-toggle cursor-pointer align-middle rounded-full">
                                <img src="https://assets.themuse.com/uploaded/companies/12214/small_logo.png?v=5dad600268712acd5fc537403000906a4069baf2e461a0d9e4bde72899c59753" width="100" height="100">
                            </a>
                            <div class="card hs-dropdown-menu transition-[opacity,margin] rounded-md duration hs-dropdown-open:opacity-100 opacity-0 mt-2 min-w-max  w-[200px] hidden z-[12]" aria-labelledby="hs-dropdown-custom-icon-trigger">
                                <div class="card-body p-0 py-2">
                                    <a href="javscript:void(0)" class="flex gap-2 items-center font-medium px-4 py-1.5 hover:bg-gray-200 text-gray-400">
                                        <i class="ti ti-user  text-xl "></i>
                                        <p class="text-sm ">My Profile</p>
                                    </a>
                                    <a href="javscript:void(0)" class="flex gap-2 items-center font-medium px-4 py-1.5 hover:bg-gray-200 text-gray-400">
										<i class="ti ti-mail  text-xl"></i>
                                        <p class="text-sm ">My Account</p>
                                    </a>
                                    <a href="javscript:void(0)" class="flex gap-2 items-center font-medium px-4 py-1.5 hover:bg-gray-200 text-gray-400">
                                        <i class="ti ti-list-check  text-xl "></i>
                                        <p class="text-sm ">My Task</p>
                                    </a>
                                    <div class="px-4 mt-[7px] grid">
                                        <a href="{% url 'login' %}" class="btn-outline-primary font-medium text-[15px] w-full hover:bg-blue-600 hover:text-white">Logout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
                <!-- ========== END HEADER ========== -->
            </header>
            <!--  Header End -->
            <div class="col-span-2">
				<div class="card h-full">
					<div class="card-body">
						<h4 class="text-gray-500 text-lg font-semibold mb-5">Manage Task</h4>
						<div class="relative overflow-x-auto">
							<table class="text-left w-full whitespace-nowrap text-sm text-gray-500">
								<thead>
									<tr class="text-sm">
										<th scope="col" class="p-4 font-semibold">Title</th>
										<th scope="col" class="p-4 font-semibold">Description</th>
										<th scope="col" class="p-4 font-semibold">Assigned To</th>
										<th scope="col" class="p-4 font-semibold">Status</th>
										<th scope="col" class="p-4 font-semibold">Priority</th>
										<th scope="col" class="p-4 font-semibold">Due Date</th>
										<th scope="col" class="p-4 font-semibold">Actions</th>
									</tr>
								</thead>
								<tbody>
									{% for task in tasks %}
									<tr>
										<td class="p-4">
											<h3 class="font-medium text-teal-500">{{ task.title }}</h3>
										</td>
										<td class="p-4">
											<h3 class="font-medium text-teal-500">{{ task.description }}</h3>
										</td>
										<td class="p-4">
											<h3 class="font-medium text-teal-500">{{ task.assigned_to }}</h3>
										</td>
										<td class="p-4">
											<span class="inline-flex items-center py-2 px-4 rounded-3xl font-semibold bg-teal-400 text-teal-500">{{ task.status }}</span>
										</td>
										<td class="p-4">
											<h3 class="font-medium text-teal-500">{{ task.priority }}</h3>
										</td>
										<td class="p-4">
											<h3 class="font-medium text-teal-500">{{ task.due_date }}</h3>
										</td>
										<td class="p-4">
											<button class="btn btn-primary edit-btn" data-task-id="{{ task.id }}">Edit</button>
											<button class="btn btn-danger delete-btn" data-task-id="{{ task.id }}">Delete</button>
											<style>
											  .btn {
												padding: 10px 20px;
												border: none;
												font-size: 16px;
												cursor: pointer;
											  }
											  .btn-primary {
												background-color: #4CAF50; /* Green */
												color: white;
											  }
											  .btn-danger {
												background-color: #f44336; /* Red */
												color: white;
											  }
											  .btn:hover {
												opacity: 0.8;
											  }
											</style>
										</td>
									</tr>
									{% empty %}
									<tr>
										<td colspan="9" class="p-4 text-center">
											No tasks available
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
        </main>
		<script>
			// script.js
			$('.edit-btn').click(function() {
				console.log('Edit button clicked!');
				var taskId = $(this).data('task-id');
				console.log('Task ID:', taskId);
				$('#task-modal').modal('show');
				$.ajax({
					type: 'GET',
					url: '/get_task_details/' + taskId + '/',
					data: {
						task_id: taskId
					},
					success: function(data) {
						console.log(data);
						$('#title').val(data.title);
						$('#description').val(data.description);
						$('#assigned_to').val(data.assigned_to.username);
						$('#status').val(data.status);
						$('#priority').val(data.priority);
						$('#due_date').val(data.due_date);
					}
				});
			});

			// Update the task when the form is submitted
			$('#updatetaskForm').submit(function(event) {
				event.preventDefault();
				var taskId = $(this).data('task-id');
				var formData = $(this).serializeArray(); // Use serializeArray() instead of serialize()
				formData.push({ name: 'task_id', value: taskId }); // Add task ID to form data
				$.ajax({
					type: 'POST',
					url: '/update_task_details', // Remove the trailing slash
					data: formData,
					success: function(data) {
						console.log(data);
						if (data.message === 'Task updated successfully') {
							$('#task-modal').modal('hide');
							location.reload();
						} else {
							alert('Error updating task');
						}
					}
				});
			});
			$(document).on('click', '.delete-button', function() {
				var task_id = $(this).data('task-id');
				$.ajax({
					type: 'POST',
					url: '{% url "delete_task" %}',
					data: {
						'task_id': task_id,
						'csrfmiddlewaretoken': '{{ csrf_token }}'
					},
					success: function(data) {
						console.log('Task deleted successfully!');
					},
					error: function(xhr, status, error) {
						console.log('Error deleting task:', error);
					}
				});
			});
		</script>
    </body>
</html>